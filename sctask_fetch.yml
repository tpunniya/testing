---
- name: Fetch SCTask details from ServiceNow
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Fetch SCTask details
      uri:
        url: "https://dev110810.service-now.com/api/now/table/sctask"
        method: GET
        user: "admin"
        password: "wO+LRiiV17*n"
        body_format: json
        headers:
          Accept: "application/json"
      register: sctask_details

    - name: Save JSON payload to global variable
      set_fact:
        sctask_payload: "{{ sctask_details.json | from_json }}"
      
    - name: Save JSON payload to a file
      copy:
        content: "{{ sctask_details.content }}"
        dest: "C:\\temp\\sctask_details.json"
